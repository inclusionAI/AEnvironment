apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "redis-stateful.name" . }}-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "redis-stateful.labels" . | nindent 4 }}
data:
  redis.conf: |
    # Redis configuration
    bind 0.0.0.0
    port 6379
    dir /data

    # 持久化配置
    save 900 1
    save 300 10
    save 60 10000
    rdbcompression yes
    dbfilename dump.rdb

    # AOF配置
    appendonly yes
    appendfilename "appendonly.aof"
    appendfsync everysec

    # 安全配置
    requirepass {{ .Values.redis.password }}
    masterauth {{ .Values.redis.password }}

    # 主从配置 - 从节点会动态配置
    # replicaof 将在运行时通过lifecycle hook设置
