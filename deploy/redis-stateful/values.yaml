# Default values for redis-stateful.

name: redis-stateful

# Global settings - will be overridden by parent chart
global:
  namespace: aenv
  labels: {}
  selectorLabels:
    app.kubernetes.io/name: "{{ .Values.name }}"

metadata:
  namespace: aenv

# Namespace configuration
namespace:
  # Set to true to automatically create the namespace
  create: true
  # Optional labels to add to the namespace
  labels: {}
  # Optional annotations to add to the namespace
  annotations: {}

image: redis:7.2.4
imagePullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

# Redis configuration
redis:
  # Redis password
  password: "yourpassword"

  # Master configuration
  master:
    name: master
    replicas: 1
    # 可选：直接指定主节点地址，如果不指定则使用默认的StatefulSet DNS
    host: ""
    resources:
      limits:
        cpu: "1"
        memory: "1Gi"
      requests:
        cpu: "100m"
        memory: "256Mi"

  # Slave configuration
  slave:
    name: slave
    replicas: 2
    resources:
      limits:
        cpu: "1"
        memory: "1Gi"
      requests:
        cpu: "100m"
        memory: "256Mi"

# Service configuration
service:
  type: ClusterIP
  port: 6379

# Headless service for StatefulSet
headlessService:
  name: redis-headless
  port: 6379

# 持久化配置
persistence:
  enabled: true
  storageClassName: ""
  accessModes:
    - ReadWriteOnce
  size: 5Gi

# Redis配置
config:
  # Redis配置文件内容
  redisConf: |
    # Redis configuration
    bind 0.0.0.0
    port 6379
    dir /data
    save 900 1
    save 300 10
    save 60 10000
    rdbcompression yes
    dbfilename dump.rdb
    appendonly yes
    appendfilename "appendonly.aof"
    appendfsync everysec

    # 主从配置
    # replicaof 配置将在运行时通过环境变量设置
    masterauth {{ .Values.redis.password }}
    requirepass {{ .Values.redis.password }}

nodeSelector: {}

tolerations: {}

affinity: {}

# 备份配置
backup:
  # OSS配置（可选）
  oss:
    endpoint: ""
    bucket: ""
    accessKey: ""
    secretKey: ""
