# Default values for AEnv Platform umbrella chart
# This file contains default values for all sub-charts

# Global settings
global:
  namespace: aenv
  createNamespace: true
  selectorLabels:
    app.kubernetes.io/name: "{{ .Values.name }}"
  sandboxNamespace: aenv-sandbox
  domain: cluster.local
  redisClusterEnabled: false

# Controller component
controller:
  enabled: true
  replicaCount: 1
  name: controller
  metadata:
    namespace: aenv
  sandboxNamespace: aenv-sandbox
  namespace:
    create: true
  image: aenvironment/controller:0.1.0
  imagePullPolicy: IfNotPresent
  service:
    type: LoadBalancer
    port: 8080
  resources:
    limits:
      cpu: "2"
      memory: "4G"
      ephemeral-storage: 10Gi
    requests:
      cpu: "0"
      memory: "0"
      ephemeral-storage: 10Gi

# Redis component
# Note: This redis component is controlled by global.redisClusterEnabled
# When global.redisClusterEnabled=false, this component will be enabled
# When global.redisClusterEnabled=true, this component will be disabled
redis:
  enabled: false
  # For persistence with ReadWriteOnce access mode, replicaCount must be 1.
  replicaCount: 1
  name: redis
  metadata:
    namespace: aenv
  namespace:
    create: false
  image: redis:7.2.4
  backupImage: alpine:3.18
  imagePullPolicy: IfNotPresent
  service:
    type: LoadBalancer
    port: 6379
  resources:
    limits:
      cpu: "1"
      memory: "2Gi"
      ephemeral-storage: 10Gi
    requests:
      cpu: "0.5"
      memory: "1Gi"
      ephemeral-storage: 10Gi
  # Redis persistence configuration
  persistence:
    # RDB+AOF hybrid persistence
    # Save rules for RDB snapshots:
    # - 900 seconds (15 minutes) if at least 1 key changed
    # - 300 seconds (5 minutes) if at least 10 keys changed
    # - 60 seconds (1 minute) if at least 10000 keys changed
    save: "900 1 300 10 60 10000"
    appendonly: "yes"
    appendfilename: "appendonly.aof"
    appendfsync: "everysec"
    no-appendfsync-on-rewrite: "no"
    auto-aof-rewrite-percentage: 100
    auto-aof-rewrite-min-size: "64mb"
    aof-load-truncated: "yes"
    aof-use-rdb-preamble: "yes"
    oss:
      endpoint: ""
      bucket: ""
      accessKey: ""
      secretKey: ""

# Redis Cluster component
# Note: This redis-cluster component is controlled by global.redisClusterEnabled
# When global.redisClusterEnabled=true, this component will be enabled
# When global.redisClusterEnabled=false, this component will be disabled
redis-cluster:
  enabled: true
  # Default values for redis-cluster.
  name: redis-cluster
  # Namespace configuration
  namespace:
    # Set to true to automatically create the namespace
    create: false
  image: redis:7.2.4
  imagePullPolicy: IfNotPresent
  initImage: busybox:1.36
  # Redis configuration
  redis:
    # Redis Cluster 配置
    cluster:
      enabled: true
      # 集群节点数量，必须是3的倍数（3主3从，6主6从等）
      nodes: 6
      # 每个主节点的副本数量
      replicas: 1
      # Redis密码
      password: "redis123"
      port: 6379
      # 集群端口（节点通信端口）
      clusterBusPort: 16379
    # 单个节点资源配置
    node:
      name: node
      resources:
        limits:
          cpu: "1"
          memory: "1Gi"
          ephemeral-storage: 5Gi
        requests:
          cpu: "100m"
          memory: "256Mi"
          ephemeral-storage: 5Gi

  # 持久化配置
  persistence:
    enabled: true
    storageClassName: ""
    accessModes:
      - ReadWriteOnce
    size: 5Gi

# EnvHub component
envhub:
  enabled: true
  replicaCount: 1
  name: envhub
  metadata:
    namespace: aenv
  namespace:
    create: false
  image: aenvironment/envhub:0.1.0
  imagePullPolicy: IfNotPresent
  redisPassword: "redis123"
  service:
    type: LoadBalancer
    port: 8083
    metricsPort: 9091
  resources:
    limits:
      cpu: "2"
      memory: "4G"
      ephemeral-storage: 10Gi
    requests:
      cpu: "0"
      memory: "0"
      ephemeral-storage: 10Gi

# API Service component
api-service:
  enabled: false

api-service-k8s:
  enabled: true
  replicaCount: 1
  name: api-service-k8s
  metadata:
    namespace: aenv
  namespace:
    create: false
  image: aenvironment/api-service:0.1.0
  imagePullPolicy: IfNotPresent
  service:
    type: LoadBalancer
    port: 8080
    mcpProxyPort: 8081
  resources:
    limits:
      cpu: "2"
      memory: "4G"
      ephemeral-storage: 10Gi
    requests:
      cpu: "0"
      memory: "0"
      ephemeral-storage: 10Gi
